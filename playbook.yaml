---
- hosts: localhost
  connection: local
  collections:
    - devsec.hardening
  roles:
    - packages
    - unattended-upgrades
    - session-counter
    - configure-monitor-mode
    # There are some mmap_rnd_bits errors being thrown that we want to ignore.
    - { role: lockdown, ignore_errors: yes, when: lockdown is defined  }
    - remove-x
    # The lockdown removes us from passwordless sudo... so it has to come last.
    - { role: devsec.hardening.os_hardening, ignore_errors: yes, become: yes }
    - { role: devsec.hardening.ssh_hardening, ignore_errors: yes, become: yes }
    
  vars:
    sysctl_overwrite:
      vm.mmap_rnd_bits: 16
